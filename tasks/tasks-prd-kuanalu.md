## Relevant Files

- `app/layout.tsx` - Main layout component for the application
- `app/page.tsx` - Homepage component
- `lib/db/schema.ts` - Database schema definitions using Drizzle ORM
- `lib/db/index.ts` - Database connection setup
- `components/auth/` - Authentication components
- `components/ui/` - Reusable UI components
- `components/kanban-board.tsx` - Kanban board component with responsive design
- `components/kanban-column.tsx` - Kanban column component for displaying tasks with responsive layout
- `components/kanban-filter.tsx` - Filter component for tasks
- `components/kanban-sort.tsx` - Sort component for tasks
- `components/create-task-dialog.tsx` - Dialog for creating new tasks
- `components/task-card.tsx` - Task card component
- `components/task-detail.tsx` - Task detail page component
- `components/task-list.tsx` - Task list component for list view
- `components/task-list-filter.tsx` - Filter component for task list view
- `components/calendar-view.tsx` - Calendar view component for displaying tasks by due date
- `components/simple-search.tsx` - Simple search component for task searching
- `components/projects/project-detail-content.tsx` - Project detail content with tabs for different views
- `app/api/auth/[...nextauth]/route.ts` - Authentication API routes
- `app/api/tasks/route.ts` - Tasks API endpoints
- `app/api/projects/route.ts` - Projects API endpoints
- `app/api/organizations/route.ts` - Organizations API endpoints
- `app/task/[id]/page.tsx` - Task detail page
- `app/projects/[id]/page.tsx` - Project page with task board
- `app/(auth)/projects/[id]/list/page.tsx` - List view for tasks
- `app/(auth)/projects/[id]/calendar/page.tsx` - Calendar view for tasks
- `app/auth/register/page.tsx` - User registration page
- `app/auth/login/page.tsx` - User login page
- `app/auth/logout/page.tsx` - User logout page
- `app/profile/page.tsx` - User profile page
- `app/api/user/profile/route.ts` - User profile update API endpoint
- `app/api/user/password/route.ts` - User password update API endpoint
- `components/auth/user-profile-form.tsx` - User profile form component
- `app/api/auth/register/route.ts` - User registration API endpoint
- `app/api/auth/verify-credentials/route.ts` - Credential verification API endpoint
- `app/dashboard/page.tsx` - Dashboard page for authenticated users
- `lib/auth/permissions.ts` - Role-based permissions utility
- `lib/auth/server-permissions.ts` - Server-side permission checking utility
- `lib/actions/role-actions.ts` - Server actions for role management
- `components/auth/role-manager.tsx` - Role management UI component
- `components/auth/with-permission.tsx` - Permission-based component wrapper
- `middleware.ts` - Authentication and authorization middleware
- `app/organizations/page.tsx` - Organizations listing page
- `app/organizations/[id]/page.tsx` - Organization detail page
- `lib/actions/organization-actions.ts` - Server actions for organization management
- `components/organizations/create-organization-dialog.tsx` - Dialog for creating organizations
- `components/organizations/organization-settings.tsx` - Organization settings component
- `components/organizations/organization-members.tsx` - Organization members management component
- `components/organizations/organization-projects.tsx` - Organization projects component
- `components/organizations/create-project-dialog.tsx` - Dialog for creating projects
- `components/organizations/invite-user-dialog.tsx` - Dialog for inviting users
- `app/api/projects/route.ts` - API endpoint for projects
- `app/api/organizations/[id]/projects/route.ts` - API endpoint for organization projects
- `lib/actions/invitation-actions.ts` - Server actions for invitation management
- `components/organizations/pending-invitations.tsx` - Component for displaying pending invitations
- `app/api/invitations/accept/route.ts` - API endpoint for accepting invitations
- `lib/db/migrations/add-invitations-table.ts` - Migration script for invitations table
- `lib/db/migrations/enhance-organization-schema.ts` - Migration script for enhancing organization schema
- `types/organization.ts` - TypeScript types for organization schema
- `lib/db/migrations/enhance-user-schema.ts` - Migration script for enhancing user schema
- `types/user.ts` - TypeScript types for user schema
- `lib/actions/user-actions.ts` - Server actions for user management
- `lib/db/migrations/enhance-project-schema.ts` - Migration script for enhancing project schema
- `types/project.ts` - TypeScript types for project schema
- `lib/actions/project-actions.ts` - Server actions for project management
- `lib/db/migrations/enhance-task-schema.ts` - Migration script for enhancing task schema
- `types/task.ts` - TypeScript types for task schema
- `src/lib/db/migrations/enhance-subtask-schema.ts` - Migration script for enhancing subtask schema
- `src/types/subtask.ts` - TypeScript types for subtask schema
- `src/lib/db/migrations/enhance-comment-schema.ts` - Migration script for enhancing comment schema
- `src/types/comment.ts` - TypeScript types for comment schema
- `src/lib/db/migrations/enhance-relationships.ts` - Migration script for enhancing schema relationships
- `docs/schema-relationships.md` - Documentation of database schema relationships
- `src/app/api/organizations/route.ts` - API endpoint for listing and creating organizations
- `src/app/api/organizations/[id]/route.ts` - API endpoint for getting, updating, and deleting organizations
- `src/app/api/organizations/[id]/members/route.ts` - API endpoint for managing organization members
- `src/app/api/organizations/[id]/members/[userId]/route.ts` - API endpoint for managing individual organization members
- `components/layout/app-shell.tsx` - Main layout component for the application
- `components/layout/header.tsx` - Header component for the application
- `components/layout/sidebar.tsx` - Sidebar component with navigation and project list

### Notes

- Unit tests should be placed alongside the code files they are testing
- Use `npx jest [optional/path/to/test/file]` to run tests
- For database migrations, use Drizzle's migration tools: `npx drizzle-kit push:pg`
- Use Shadcn UI components for consistent styling and accessibility

## Tasks

- [x] 1.0 Project Setup and Configuration
  - [x] 1.1 Initialize Next.js project with TypeScript and Tailwind CSS
  - [x] 1.2 Set up project folder structure (app, components, lib)
  - [x] 1.3 Configure Drizzle ORM with Neon Postgres
  - [x] 1.4 Set up environment variables (.env.local)
  - [x] 1.5 Install and configure required dependencies
  - [x] 1.6 Set up authentication provider (NextAuth.js)
  - [x] 1.7 Configure ESLint and Prettier
  - [x] 1.8 Set up base layout and theme with Tailwind
  - [x] 1.9 Create reusable UI components with Shadcn UI

- [x] 2.0 Authentication and User Management
  - [x] 2.1 Implement user registration flow
  - [x] 2.2 Implement login functionality
  - [x] 2.3 Create user profile page
  - [x] 2.4 Implement role-based access control
  - [x] 2.5 Create organization creation and management UI
  - [x] 2.6 Implement user invitation system
  - [x] 2.7 Create organization settings page
  - [x] 2.8 Implement user role management within organizations
  - [x] 2.9 Add protected routes and authentication middleware

- [x] 3.0 Database Schema and API Development
  - [x] 3.1 Define organization schema
  - [x] 3.2 Define user schema with role information
  - [x] 3.3 Define project schema
  - [x] 3.4 Define task schema with status, priority fields
  - [x] 3.5 Define subtask schema
  - [x] 3.6 Define comment schema
  - [x] 3.7 Create relationships between schemas
  - [x] 3.8 Implement organization API endpoints
  - [x] 3.9 Implement project API endpoints
  - [x] 3.10 Implement task API endpoints
  - [x] 3.11 Implement subtask API endpoints
  - [x] 3.12 Implement comment API endpoints
  - [x] 3.13 Add validation to all API endpoints
  - [x] 3.14 Create database seed script for development

- [x] 4.0 Kanban Board Implementation
  - [x] 4.1 Create kanban board layout with 5 columns
  - [x] 4.2 Implement task card component
  - [x] 4.3 Add drag and drop functionality between columns
  - [x] 4.4 Implement task status updates on drop
  - [x] 4.5 Add visual feedback during dragging
  - [x] 4.6 Create task filtering functionality
  - [x] 4.7 Implement task sorting options
  - [x] 4.8 Add create task button and modal
  - [x] 4.9 Create project sidebar component
  - [x] 4.10 Implement responsive design for kanban board

- [ ] 5.0 Task Management Features
  - [x] 5.1 Create task detail page layout (2-column)
  - [x] 5.2 Implement task information section
  - [x] 5.3 Create subtask management UI
  - [x] 5.4 Implement subtask creation, editing, and completion
  - [x] 5.5 Create comments section
  - [x] 5.6 Implement comment creation and display
  - [x] 5.7 Add task details sidebar with metadata
  - [x] 5.8 Implement task editing functionality
  - [x] 5.9 Create task assignment dropdown
  - [x] 5.10 Add priority selection UI
  - [x] 5.11 Implement due date picker
  - [ ] 5.12 Create task history/activity log

- [x] 6.0 Additional Views (List and Calendar)
  - [x] 6.1 Create list view component for tasks
  - [x] 6.2 Implement sorting and filtering in list view
  - [x] 6.3 Add pagination to list view
  - [x] 6.4 Create calendar view component
  - [x] 6.5 Implement task display by due date in calendar
  - [x] 6.6 Add month/week/day view options in calendar
  - [x] 6.7 Create view switcher component
  - [x] 6.8 Implement consistent task actions across views
  - [x] 6.9 Ensure responsive design for all views

- [ ] 7.0 Email Notifications
  - [ ] 7.1 Set up email service provider
    - [x] 7.1.1 Install Resend and React Email packages
    - [x] 7.1.2 Set up environment variables for Resend API key
    - [x] 7.1.3 Create email utility functions for sending emails
    - [x] 7.1.4 Set up email queue table in the database schema
    - [x] 7.1.5 Create email queue processing functionality
    - [x] 7.1.6 Implement email preview functionality for development
    - [x] 7.1.7 Set up webhook handler for email delivery status
  - [ ] 7.2 Create email templates for notifications
    - [x] 7.2.1 Create base email layout component
    - [x] 7.2.2 Create organization invitation email template
    - [x] 7.2.3 Create task assignment notification template
    - [ ] 7.2.4 Create task update notification template
    - [ ] 7.2.5 Create comment notification template
  - [ ] 7.3 Implement task assignment notification
    - [ ] 7.3.1 Update task assignment logic to trigger email notifications
    - [ ] 7.3.2 Create server action for sending assignment notifications
    - [ ] 7.3.3 Add assignment notification to task card and detail view
  - [ ] 7.4 Add task update notification logic
    - [ ] 7.4.1 Identify key task updates that should trigger notifications
    - [ ] 7.4.2 Implement notification logic in task update actions
    - [ ] 7.4.3 Add recipients determination logic based on task watchers
  - [ ] 7.5 Create comment notification system
    - [ ] 7.5.1 Update comment creation to trigger notifications
    - [ ] 7.5.2 Implement mention detection in comments
    - [ ] 7.5.3 Send notifications to task assignee and mentioned users
  - [ ] 7.6 Implement notification preferences for users
    - [ ] 7.6.1 Add notification preferences to user schema
    - [ ] 7.6.2 Create notification settings UI in user profile
    - [ ] 7.6.3 Update notification sending logic to respect user preferences
  - [ ] 7.7 Add email queue for reliable delivery
    - [ ] 7.7.1 Implement retry logic for failed email sends
    - [ ] 7.7.2 Create background job for processing email queue
    - [ ] 7.7.3 Set up monitoring for email delivery status
  - [ ] 7.8 Create notification history page
    - [ ] 7.8.1 Add notification history table to database schema
    - [ ] 7.8.2 Create notification history UI component
    - [ ] 7.8.3 Implement notification read/unread status
  - [ ] 7.9 Implement organization invitation system
    - [x] 7.9.1 Update invitation dialog to send emails
    - [ ] 7.9.2 Create invitation acceptance route and page

- [ ] 8.0 Permissions System Enhancement
  - [x] 8.1 Update user registration to include organization creation
  - [x] 8.2 Implement organization ownership assignment during registration
  - [x] 8.3 Create comprehensive role-based permission system and fix transaction issues
  - [x] 8.4 Implement permission checks for all API endpoints
  - [x] 8.5 Add UI components for role management
  - [ ] 8.6 Create user invitation flow with role assignment
  - [ ] 8.7 Implement organization settings page with member management
  - [ ] 8.8 Add visual indicators for user permissions in UI
  - [ ] 8.9 Create audit logging for permission changes
  - [ ] 8.10 Add graceful error handling for permission denied scenarios 
